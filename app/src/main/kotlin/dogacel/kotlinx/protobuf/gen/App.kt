/*
 * This Kotlin source file was generated by the Gradle 'init' task.
 */
@file:OptIn(ExperimentalSerializationApi::class)

package dogacel.kotlinx.protobuf.gen

import com.google.protobuf.util.JsonFormat
import kotlinx.serialization.ExperimentalSerializationApi
import kotlinx.serialization.Serializable
import kotlinx.serialization.decodeFromByteArray
import kotlinx.serialization.encodeToString
import kotlinx.serialization.json.Json
import kotlinx.serialization.protobuf.ProtoBuf
import kotlinx.serialization.protobuf.ProtoNumber
import test.Test
import test.testMessage

@Serializable
data class KTestMessage(
    @ProtoNumber(number = 1)
    val anotherName: Int,
    val name: String,
) {
    data class Nested(
        val a: Int
    )
}


fun main() {
    val testMessage = testMessage {
        id = 1
        name = "test"
    }

    val printer = JsonFormat
        .printer()
        .includingDefaultValueFields()
//        .omittingInsignificantWhitespace()

    println(printer.print(testMessage))

    val kMessage: KTestMessage = ProtoBuf.decodeFromByteArray(testMessage.toByteArray())
    println(kMessage)
    println(Json.encodeToString(kMessage))

    val messageDescriptor = Test.TestMessage.getDescriptor()

    println(printer.print(messageDescriptor.toProto()))
}
